{% extends "base.html" %}
{% block title %}Sepetim | HemenYe{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-8">
    <div class="card glass mb-3">
      <div class="card-body">
        <h4>Sepetim</h4>
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr><th>Ürün</th><th>Adet</th><th>Birim Fiyat</th><th>Ara Toplam</th><th></th></tr>
            </thead>
            <tbody>
              {% for item in cart_items %}
                <tr>
                  <td>{{ item.name }}</td>
                  <td>
                    <div class="d-flex align-items-center">
                      <form action="/customer/cart/decrease" method="POST" class="me-1">
                        <input type="hidden" name="product_id" value="{{ item.id }}">
                        <button class="btn btn-sm btn-outline-secondary">-</button>
                      </form>
                      <span class="px-2">{{ item.quantity }}</span>
                      <form action="/customer/cart/increase" method="POST" class="ms-1">
                        <input type="hidden" name="product_id" value="{{ item.id }}">
                        <button class="btn btn-sm btn-outline-secondary">+</button>
                      </form>
                    </div>
                  </td>
                  <td>{{ item.unit_price }}</td>
                  <td>{{ item.subtotal }}</td>
                  <td>
                    <form action="/customer/cart/remove" method="POST">
                      <input type="hidden" name="product_id" value="{{ item.id }}">
                      <button class="btn btn-sm btn-link text-danger">Sil</button>
                    </form>
                  </td>
                </tr>
              {% else %}
                <tr><td colspan="5" class="text-muted">Sepetiniz boş.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card glass">
      <div class="card-body">
        <h5>Ödeme Özeti</h5>
        <div class="mb-3">
          <label class="form-label">Kupon Kodu</label>
          {% if coupon %}
            <div class="d-flex align-items-center gap-2">
              <span class="badge bg-success">Uygulandı: {{ coupon.code }}</span>
              <form action="/customer/cart/remove_coupon" method="POST">
                <button class="btn btn-sm btn-outline-danger">Kaldır</button>
              </form>
            </div>
          {% else %}
            <form action="/customer/cart/apply_coupon" method="POST" class="input-group">
              <input type="text" name="coupon_code" class="form-control" placeholder="Kupon girin">
              <button class="btn btn-outline-primary">Uygula</button>
            </form>
          {% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Sipariş Notu</label>
          <textarea name="note" class="form-control" rows="2" form="confirm-form"></textarea>
        </div>
        <ul class="list-group list-group-flush mb-3">
          <li class="list-group-item d-flex justify-content-between"><span>Ara Toplam</span><strong>{{ totals.subtotal }}</strong></li>
          <li class="list-group-item d-flex justify-content-between"><span>İndirim</span><strong>-{{ totals.discount }}</strong></li>
          <li class="list-group-item d-flex justify-content-between"><span>Genel Toplam</span><strong>{{ totals.total }}</strong></li>
        </ul>
        <form id="confirm-form" action="/customer/order/confirm" method="POST">
          <button class="btn btn-primary w-100">Siparişi Onayla</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
